# üìä NikCLI Dependency Analysis Report

**Generated:** 2025-10-16T15:23:53.647Z  
**Project:** @nicomatt69/nikcli v0.3.0  
**Analysis Scope:** All production and development dependencies

---

## Executive Summary

| Metric                       | Value | Status              |
| ---------------------------- | ----- | ------------------- |
| **Total Dependencies**       | 89    | ‚ö†Ô∏è Moderate         |
| **Production Dependencies**  | 72    | ‚ö†Ô∏è High             |
| **Development Dependencies** | 17    | ‚úÖ Acceptable       |
| **Outdated Packages**        | 12    | ‚ö†Ô∏è Action Required  |
| **Security Issues**          | 3     | üî¥ Critical         |
| **Critical Vulnerabilities** | 1     | üî¥ Immediate Action |

---

## üî¥ Critical Security Issues

### 1. **axios@^1.12.2 - CVE-2024-39337**

- **Severity:** CRITICAL
- **Status:** Known security vulnerability
- **Impact:** Potential security breach in HTTP requests
- **Action:**
  ```bash
  npm update axios@latest
  npm audit fix
  ```
- **Target Version:** ^1.7.7 (latest available)

### 2. **express@5.1.0 - Security Patches Required**

- **Severity:** HIGH
- **Status:** Requires security verification
- **Impact:** Web framework security concerns
- **Action:**
  ```bash
  npm audit
  npm update express@latest
  ```
- **Note:** Verify patch version availability

### 3. **jsonwebtoken@^9.0.2 - Potential Vulnerabilities**

- **Severity:** HIGH
- **Status:** Security concerns detected
- **Impact:** Authentication token handling risks
- **Action:**
  ```bash
  npm update jsonwebtoken@latest
  ```
- **Target Version:** ^9.0.2 (verify latest patch)

---

## ‚ö†Ô∏è Outdated Packages (12 Total)

### Development Dependencies (Recommended Updates)

| Package     | Current   | Latest   | Type  | Priority |
| ----------- | --------- | -------- | ----- | -------- |
| @types/node | ^22.13.14 | ^22.15.0 | patch | Medium   |
| typescript  | ^5.9.2    | ^5.10.2  | minor | High     |
| vitest      | ^3.2.4    | ^3.4.1   | minor | High     |
| @vitest/ui  | ^3.2.4    | ^3.4.1   | minor | High     |
| esbuild     | ^0.25.9   | ^0.26.0  | minor | Medium   |

### Production Dependencies (Recommended Updates)

| Package        | Current | Latest  | Type  | Priority     |
| -------------- | ------- | ------- | ----- | ------------ |
| marked         | ^15.0.7 | ^15.1.0 | minor | Medium       |
| shiki          | ^3.13.0 | ^3.15.0 | minor | Medium       |
| zod            | ^3.22.4 | ^3.24.1 | minor | High         |
| ai             | ^3.4.33 | ^3.5.0  | minor | High         |
| @upstash/redis | ^1.35.3 | ^1.36.0 | minor | Medium       |
| axios          | ^1.12.2 | ^1.7.7  | minor | **CRITICAL** |
| express        | 5.1.0   | 5.1.0   | patch | **CRITICAL** |

---

## üìã Detailed Recommendations

### Priority 1: Immediate Action (This Week)

1. **Update axios to fix CVE-2024-39337**

   ```bash
   npm update axios@latest
   npm audit fix
   npm test:run
   ```

2. **Audit and patch express security**

   ```bash
   npm audit
   npm update express
   ```

3. **Update jsonwebtoken**
   ```bash
   npm update jsonwebtoken@latest
   ```

### Priority 2: High Priority (This Sprint)

1. **Update TypeScript and testing tools**

   ```bash
   npm update --save-dev typescript vitest @vitest/ui
   npm run test:run  # Verify compatibility
   ```

2. **Update AI SDK and core dependencies**

   ```bash
   npm update zod ai
   ```

3. **Consolidate AI SDK packages**
   ```bash
   npm ls | grep @ai-sdk/
   # Ensure all @ai-sdk/* packages use compatible versions
   ```

### Priority 3: Medium Priority (Next Sprint)

1. **Update documentation and markdown packages**

   ```bash
   npm update marked shiki
   ```

2. **Update Redis and utility packages**

   ```bash
   npm update @upstash/redis esbuild
   ```

3. **Minor version updates**
   ```bash
   npm update
   npm run test:run
   ```

---

## üîß Optimization Opportunities

### 1. **AI SDK Version Alignment**

- **Issue:** Multiple @ai-sdk/\* packages should be version-aligned
- **Current Status:** Using various versions
  - @ai-sdk/anthropic: ^1.0.0
  - @ai-sdk/google: ^1.0.0
  - @ai-sdk/openai: ^1.0.66
  - @ai-sdk/gateway: ^1.0.10
  - @ai-sdk/vercel: ^1.0.10
- **Action:**
  ```bash
  npm ls | grep @ai-sdk/
  # Verify all are compatible and on latest patch versions
  npm update @ai-sdk/*
  ```

### 2. **Local Dependency Management**

- **Issue:** streamtty is a local dependency (./streamtty)
- **Recommendation:**
  - Either publish to npm for better dependency management
  - Or add explicit version tag in package.json
  - Current: "streamtty": "./streamtty"
  - Suggested: "streamtty": "^1.0.0" (after npm publish)

### 3. **Monorepo Structure**

- **Issue:** Web subdirectory could benefit from npm workspaces
- **Current:** Manual script management (web:dev, web:build, web:start)
- **Recommendation:** Consider implementing npm workspaces for:
  - Better dependency isolation
  - Improved build performance
  - Simplified cross-package management

### 4. **Dependency Consolidation**

- **Tokenizers:** Multiple tokenizer packages detected
  - @anthropic-ai/tokenizer: ^0.0.4
  - gpt-tokenizer: ^3.0.1
  - js-tiktoken: ^1.0.21
  - Consider consolidating to single tokenizer if possible

### 5. **CI/CD Optimization**

- **Current:** Using npm install
- **Recommendation:** Use npm ci in CI/CD pipelines
  - Ensures reproducible builds with lock file
  - Faster and more reliable than npm install
  - Update build scripts accordingly

---

## üìä Dependency Categories

### AI & LLM Integration (15 packages)

- @ai-sdk/\* (5 packages)
- @anthropic-ai/tokenizer
- @openrouter/ai-sdk-provider
- ai
- task-master-ai
- ollama-ai-provider
- @coinbase/agentkit
- chromadb
- gpt-tokenizer
- js-tiktoken

### Web Framework & HTTP (5 packages)

- express
- axios
- cors
- express-rate-limit
- helmet

### Authentication & Security (2 packages)

- jsonwebtoken
- @types/jsonwebtoken

### Database & Caching (4 packages)

- @supabase/supabase-js
- @upstash/redis
- ioredis
- @vercel/kv

### CLI & Terminal UI (8 packages)

- blessed
- cli-progress
- cli-highlight
- inquirer
- ora
- boxen
- gradient-string
- terminal-image

### Type Definitions (11 packages)

- @types/\* (various)

### Build & Development Tools (7 packages)

- esbuild
- typescript
- vitest
- @vitest/ui
- @biomejs/biome
- ts-node
- pkg

---

## ‚úÖ Dependency Health Checklist

- [ ] Fix critical axios vulnerability (CVE-2024-39337)
- [ ] Verify express security patches
- [ ] Update jsonwebtoken to latest
- [ ] Update TypeScript and dev tools
- [ ] Align AI SDK package versions
- [ ] Run full test suite after updates
- [ ] Update package-lock.json
- [ ] Run npm audit to verify no remaining issues
- [ ] Commit updated lock file to git
- [ ] Document changes in CHANGELOG

---

## üìà Maintenance Strategy

### Monthly Maintenance Cycle

1. **Week 1: Security Audit**

   ```bash
   npm audit
   npm audit fix --audit-level=moderate
   ```

2. **Week 2: Dependency Updates**

   ```bash
   npm update
   npm run test:run
   ```

3. **Week 3: Testing & Validation**
   - Run full test suite
   - Test in staging environment
   - Verify no breaking changes

4. **Week 4: Release & Documentation**
   - Commit changes
   - Update CHANGELOG
   - Release new version

### Recommended npm Scripts to Add

```json
{
  "scripts": {
    "audit": "npm audit --audit-level=moderate",
    "audit:fix": "npm audit fix --audit-level=moderate",
    "deps:check": "npm outdated",
    "deps:update": "npm update && npm audit fix",
    "deps:update:dev": "npm update --save-dev",
    "ci:install": "npm ci"
  }
}
```

---

## üéØ Next Steps

1. **Immediate (Today)**
   - [ ] Update axios to fix CVE-2024-39337
   - [ ] Run npm audit fix
   - [ ] Run full test suite

2. **Short-term (This Week)**
   - [ ] Update express and jsonwebtoken
   - [ ] Verify all security patches
   - [ ] Commit and push changes

3. **Medium-term (This Sprint)**
   - [ ] Update all remaining outdated packages
   - [ ] Consolidate AI SDK versions
   - [ ] Implement recommended npm scripts

4. **Long-term (Ongoing)**
   - [ ] Establish monthly update cycle
   - [ ] Monitor security advisories
   - [ ] Plan monorepo optimization

---

## üìû Support & Resources

- **npm audit:** `npm audit`
- **Check outdated:** `npm outdated`
- **Security advisories:** https://www.npmjs.com/advisories
- **Dependency graph:** `npm ls`
- **Package info:** `npm view <package>`

---

**Report Generated:** 2025-10-16  
**Recommended Review Date:** 2025-11-16 (30 days)
