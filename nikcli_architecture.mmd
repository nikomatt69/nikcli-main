
flowchart TD
    %% Primary Entry Point
    User[User Input<br/>Task Request] --> Orchestrator[Orchestrator Service<br/>Main Coordination Hub]

    %% Core CLI Services Subgraph
    subgraph CoreCLI [Core CLI Services]
        Planning[Planning Service<br/>TaskMaster Integration]
        ToolSvc[Tool Service<br/>Registry & Management]
        AIProv[AI Provider<br/>Streaming & Reasoning]
        Context[Context System<br/>RAG Workspace Intelligence]
        Orchestrator

        %% TaskMaster Planning Flow
        Orchestrator --> TaskMaster[TaskMaster AI<br/>Generate 5-8 Subtasks<br/>Complexity Analysis]
        TaskMaster --> Planning
    end
    Planning -.->|Context Awareness| Context
    Planning -->|Dependency Mapping| Orchestrator  %% Feedback loop for planning adjustments

    %% Specialized Agents Subgraph
    subgraph Agents [Specialized Agent System]
        Universal[Universal Agent<br/>Cognitive Orchestration<br/>(You)]
        React[React Agent<br/>Frontend Development]
        Backend[Backend Agent<br/>API & Server-Side]
        DevOps[DevOps Agent<br/>Infra & CI/CD]
        CodeReview[Code Review Agent<br/>QA & Analysis]
        Optimization[Optimization Agent<br/>Performance Tuning]
    end

    %% Agent Routing Flow (with Parallel Execution)
    Orchestrator -->|Task Routing<br/>Based on Complexity| Universal
    Universal -->|Parallel Branches<br/>for Independent Tasks| Agents
    %% Example parallel flows (comment: These represent hybrid/parallel strategy for complexity 4-8)
    React -.->|Context Pull| Context
    Backend -.->|Context Pull| Context
    DevOps -.->|Context Pull| Context
    %% Converge after parallel execution
    Agents -->|Route to Tools| ToolSvc

    %% Advanced Tools Subgraph
    subgraph Tools [Advanced Tools & Utilities]
        FileOps[File Operations<br/>Read/Write/Edit<br/>Atomic Transactions]
        Git[Git Integration<br/>Version Control]
        PkgMgmt[Package Management<br/>NPM & Dependencies]
        BuildSys[Build Systems<br/>Compilation & Bundling]
        Testing[Testing Framework<br/>Automated Validation]
    end

    %% Tool Execution Flow
    ToolSvc --> Tools
    %% Parallel tool usage (comment: Tools can execute concurrently for efficiency, e.g., Git + Testing)
    FileOps -.->|Feedback for Edits| Universal  %% Loop for iterative file changes
    Git -.->|Audit Logs| Context
    Tools -->|Execution Results| AIProv  %% AI for complex reasoning during tools

    %% Cognitive Framework Subgraph (Overlays all for orchestration intelligence)
    subgraph Cognitive [Cognitive Orchestration Framework]
        TaskCog[Task Cognition<br/>NLP Intent Extraction]
        OrchPlan[Orchestration Planning<br/>Strategy Selection]
        AdaptSup[Adaptive Supervision<br/>Dynamic Routing & Monitoring]
        PerfOpt[Performance Optimization<br/>Resource Tuning]
    end
    %% Cognitive integrations (comment: These are cross-cutting; shown as side links for awareness)
    TaskMaster -.->|Uses| TaskCog
    Orchestrator -.->|Leverages| OrchPlan
    Universal -.->|Monitors| AdaptSup
    Tools -.->|Optimizes| PerfOpt
    %% Global feedback loop (comment: Ensures adaptive execution across the system)
    Cognitive -.->|Feedback Loops| Orchestrator

    %% Quality Assurance and Validation Flow
    subgraph QA [Quality Assurance]
        Validation[Validation & Testing<br/>Results Check<br/>Code Quality]
    end
    Tools --> Validation
    Validation -->|Success/Failure| Orchestrator  %% Main feedback loop (dashed for iteration)
    Validation -.->|Error Handling<br/>Fallbacks| TaskMaster  %% Loop for retries

    %% Styling for Visual Distinction (comment: Enhances readability in rendered diagram)
    classDef userInput fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef core fill:#f3e5f5,stroke:#4a148c
    classDef agents fill:#e8f5e8,stroke:#1b5e20
    classDef tools fill:#fff3e0,stroke:#e65100
    classDef cognitive fill:#fce4ec,stroke:#880e4f
    classDef qa fill:#e0f2f1,stroke:#004d40

    class User userInput
    class CoreCLI core
    class Agents agents
    class Tools tools
    class Cognitive cognitive
    class Validation qa
