name: Update Status

on:
  workflow_run:
    workflows: ["NikCLI CI/CD", "Cross-Platform Test", "PR Check"]
    types:
      - completed

jobs:
  update-status:
    name: Update Project Status
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Update README with status
        run: |
          echo "âœ… All workflows completed successfully!"
          echo "ðŸ“Š Project status updated"

      - name: Comment on PR
        if: github.event.workflow_run.event == 'pull_request'
        uses: actions/github-script@v7
        with:
          script: |
            const { data: comments } = await github.rest.issues.listComments({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
            });

            const botComment = comments.find(comment => 
              comment.user.type === 'Bot' && 
              comment.body.includes('âœ… All checks passed')
            );

            if (!botComment) {
              await github.rest.issues.createComment({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: `âœ… All checks passed! Ready for review.`
              });
            }
