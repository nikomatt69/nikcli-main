<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nikCLI Background Agents</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app">
        <!-- Top Navigation -->
        <header class="top-nav">
            <div class="nav-left">
                <div class="logo">
                    <div class="logo-icon">ü§ñ</div>
                    <span class="logo-text">nikCLI</span>
                </div>
                <div class="nav-tabs">
                    <div class="nav-tab active" data-tab="agents">
                        <i class="fas fa-robot"></i>
                        <span>Agents</span>
                    </div>
                    <div class="nav-tab" data-tab="dashboard">
                        <i class="fas fa-chart-line"></i>
                        <span>Dashboard</span>
                    </div>
                </div>
            </div>
            <div class="nav-right">
                <div class="user-info">
                    <div class="user-avatar">NM</div>
                </div>
            </div>
        </header>

        <!-- Main Chat Interface -->
        <main class="chat-container">
            <!-- Chat Input Area -->
            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <div class="input-header">
                        <div class="repo-selector">
                            <i class="fas fa-folder"></i>
                            <span id="currentRepo">Select repository...</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="branch-selector">
                            <i class="fas fa-code-branch"></i>
                            <span id="currentBranch">main</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                    <div class="chat-input-area">
                        <textarea 
                            id="chatInput" 
                            class="chat-input" 
                            placeholder="Ask nikCLI to start a background agent, manage jobs, or explore your codebase..."
                            rows="1"
                        ></textarea>
                        <div class="input-actions">
                            <div class="input-mode">
                                <i class="fas fa-cloud"></i>
                                <span>Auto</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <button class="attach-btn" id="attachBtn">
                                <i class="fas fa-paperclip"></i>
                            </button>
                            <button class="send-btn" id="sendBtn">
                                <i class="fas fa-arrow-up"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Messages Area -->
            <div class="chat-messages" id="chatMessages">
                <!-- Welcome Message -->
                <div class="message agent-message">
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-sender">nikCLI Assistant</span>
                            <span class="message-time">Just now</span>
                        </div>
                        <div class="message-text">
                            <p>Welcome to nikCLI Background Agents! I can help you:</p>
                            <ul>
                                <li>üöÄ Start background agents for automated tasks</li>
                                <li>üìä Monitor running jobs and their progress</li>
                                <li>‚öôÔ∏è Configure agent settings and playbooks</li>
                                <li>üîç Analyze your codebase and suggest improvements</li>
                            </ul>
                            <p>Try asking me to "start a background agent to fix failing tests" or "show me all running jobs".</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Sidebar for Agent Management -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>Background Agents</h3>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="sidebar-content">
                <!-- Quick Actions -->
                <div class="quick-actions">
                    <button class="quick-action-btn" data-action="start-agent">
                        <i class="fas fa-play"></i>
                        <span>Start Agent</span>
                    </button>
                    <button class="quick-action-btn" data-action="list-jobs">
                        <i class="fas fa-list"></i>
                        <span>List Jobs</span>
                    </button>
                    <button class="quick-action-btn" data-action="view-logs">
                        <i class="fas fa-file-alt"></i>
                        <span>View Logs</span>
                    </button>
                </div>

                <!-- Recent Activity -->
                <div class="recent-activity">
                    <h4>Recent Activity</h4>
                    <div class="activity-list" id="activityList">
                        <!-- Activity items will be populated here -->
                    </div>
                </div>

                <!-- Agent Status -->
                <div class="agent-status">
                    <h4>Agent Status</h4>
                    <div class="status-grid">
                        <div class="status-item">
                            <div class="status-dot running"></div>
                            <span>Running: <strong id="runningCount">0</strong></span>
                        </div>
                        <div class="status-item">
                            <div class="status-dot queued"></div>
                            <span>Queued: <strong id="queuedCount">0</strong></span>
                        </div>
                        <div class="status-item">
                            <div class="status-dot completed"></div>
                            <span>Completed: <strong id="completedCount">0</strong></span>
                        </div>
                        <div class="status-item">
                            <div class="status-dot failed"></div>
                            <span>Failed: <strong id="failedCount">0</strong></span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Dashboard Tab Content -->
        <div class="tab-content" id="dashboard">
            <div class="dashboard-header">
                <h2>Dashboard</h2>
                <div class="dashboard-controls">
                    <button class="btn btn-secondary" id="refreshDashboard">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3>System Overview</h3>
                    </div>
                    <div class="card-content">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="totalJobs">0</div>
                                <div class="stat-label">Total Jobs</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="activeJobs">0</div>
                                <div class="stat-label">Active Jobs</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="successRate">0%</div>
                                <div class="stat-label">Success Rate</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="avgDuration">0m</div>
                                <div class="stat-label">Avg Duration</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <h3>Recent Jobs</h3>
                        <button class="btn btn-sm btn-secondary" onclick="switchToChat()">View in Chat</button>
                    </div>
                    <div class="card-content">
                        <div class="jobs-list" id="dashboardJobsList">
                            <!-- Jobs will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="modal" id="settingsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Settings</h3>
                    <button class="modal-close" id="closeSettings">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="settings-tabs">
                        <div class="settings-tab active" data-tab="general">General</div>
                        <div class="settings-tab" data-tab="agents">Agents</div>
                        <div class="settings-tab" data-tab="config">Config Manager</div>
                    </div>

                    <div class="settings-content">
                        <!-- General Settings -->
                        <div class="settings-panel active" id="generalSettings">
                            <div class="form-group">
                                <label for="apiUrl">API URL</label>
                                <input type="text" id="apiUrl" class="form-input" value="http://localhost:3000">
                            </div>
                            <div class="form-group">
                                <label for="autoRefresh">Auto-refresh interval (seconds)</label>
                                <input type="number" id="autoRefresh" class="form-input" value="5" min="1" max="60">
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="showNotifications" checked>
                                    <span class="checkmark"></span>
                                    Show desktop notifications
                                </label>
                            </div>
                        </div>

                        <!-- Agent Settings -->
                        <div class="settings-panel" id="agentSettings">
                            <div class="form-group">
                                <label for="maxConcurrentJobs">Max concurrent jobs</label>
                                <input type="number" id="maxConcurrentJobs" class="form-input" value="3" min="1" max="10">
                            </div>
                            <div class="form-group">
                                <label for="defaultTimeLimit">Default time limit (minutes)</label>
                                <input type="number" id="defaultTimeLimit" class="form-input" value="30" min="5" max="120">
                            </div>
                            <div class="form-group">
                                <label for="defaultMemoryLimit">Default memory limit (MB)</label>
                                <input type="number" id="defaultMemoryLimit" class="form-input" value="2048" min="512" max="8192">
                            </div>
                        </div>

                        <!-- Config Manager Settings -->
                        <div class="settings-panel" id="configSettings">
                            <div class="form-group">
                                <label for="configPath">Config file path</label>
                                <input type="text" id="configPath" class="form-input" value=".nik/config.json">
                            </div>
                            <div class="form-group">
                                <label for="workspaceRoot">Workspace root</label>
                                <input type="text" id="workspaceRoot" class="form-input" value="/workspace">
                            </div>
                            <div class="form-group">
                                <label for="modelProvider">Default model provider</label>
                                <select id="modelProvider" class="form-select">
                                    <option value="anthropic">Anthropic (Claude)</option>
                                    <option value="openai">OpenAI (GPT)</option>
                                    <option value="google">Google (Gemini)</option>
                                    <option value="ollama">Ollama (Local)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="defaultModel">Default model</label>
                                <input type="text" id="defaultModel" class="form-input" value="claude-3-sonnet-20240229">
                            </div>
                            <div class="form-group">
                                <label for="temperature">Temperature</label>
                                <input type="range" id="temperature" class="form-range" min="0" max="2" step="0.1" value="0.7">
                                <span class="range-value" id="temperatureValue">0.7</span>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="enableMemory" checked>
                                    <span class="checkmark"></span>
                                    Enable memory service
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="enableSnapshots" checked>
                                    <span class="checkmark"></span>
                                    Enable snapshot service
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelSettings">Cancel</button>
                    <button class="btn btn-primary" id="saveSettings">Save Settings</button>
                </div>
            </div>
        </div>

        <!-- Job Details Modal -->
        <div class="modal" id="jobDetailsModal">
            <div class="modal-content large">
                <div class="modal-header">
                    <h3 id="jobDetailsTitle">Job Details</h3>
                    <button class="modal-close" id="closeJobDetails">&times;</button>
                </div>
                <div class="modal-body" id="jobDetailsContent">
                    <!-- Job details will be populated here -->
                </div>
            </div>
        </div>

        <!-- Notifications -->
        <div class="notifications" id="notifications"></div>
    </div>

    <script src="app.js"></script>
</body>
</html>