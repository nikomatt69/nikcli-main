{
  "metadata": {
    "generated": "${new Date().toISOString()}",
    "scope": "src/cli",
    "totalFiles": 99,
    "totalImports": 600,
    "analysisVersion": "1.0.0"
  },
  "nodes": [
    {
      "id": "nik-cli.ts",
      "type": "entry-point",
      "layer": 8,
      "size": 728362,
      "lines": 20378,
      "imports": 65,
      "exports": 61,
      "complexity": "critical",
      "issues": ["too-large", "too-many-imports", "invalid-python-imports"]
    },
    {
      "id": "core/agent-manager.ts",
      "type": "core-service",
      "layer": 5,
      "size": 19438,
      "lines": 712,
      "imports": 7,
      "exports": 1,
      "complexity": "medium",
      "issues": ["missing-event-cleanup"]
    },
    {
      "id": "chat/chat-orchestrator.ts",
      "type": "orchestrator",
      "layer": 6,
      "size": 21386,
      "lines": 612,
      "imports": 8,
      "exports": 1,
      "complexity": "medium-high",
      "issues": []
    },
    {
      "id": "context/rag-system.ts",
      "type": "context",
      "layer": 3,
      "imports": 15,
      "exports": 5,
      "complexity": "high",
      "issues": ["circular-dependency"]
    },
    {
      "id": "context/workspace-context.ts",
      "type": "context",
      "layer": 3,
      "imports": 10,
      "exports": 3,
      "complexity": "high",
      "issues": ["circular-dependency"]
    },
    {
      "id": "context/semantic-search-engine.ts",
      "type": "context",
      "layer": 3,
      "imports": 8,
      "exports": 2,
      "complexity": "medium",
      "issues": ["circular-dependency"]
    },
    {
      "id": "context/unified-embedding-interface.ts",
      "type": "context",
      "layer": 3,
      "imports": 6,
      "exports": 2,
      "complexity": "medium",
      "issues": ["circular-dependency"]
    },
    {
      "id": "ui/advanced-cli-ui.ts",
      "type": "ui",
      "layer": 7,
      "imports": 12,
      "exports": 1,
      "complexity": "high",
      "issues": ["circular-ui-loop"]
    },
    {
      "id": "services/agent-service.ts",
      "type": "service",
      "layer": 4,
      "imports": 25,
      "exports": 8,
      "complexity": "high",
      "issues": ["high-coupling"]
    },
    {
      "id": "services/tool-service.ts",
      "type": "service",
      "layer": 4,
      "imports": 20,
      "exports": 10,
      "complexity": "high",
      "issues": ["high-coupling"]
    }
  ],
  "edges": [
    {
      "from": "nik-cli.ts",
      "to": "core/agent-manager.ts",
      "type": "import",
      "weight": 10
    },
    {
      "from": "nik-cli.ts",
      "to": "chat/chat-orchestrator.ts",
      "type": "import",
      "weight": 8
    },
    {
      "from": "nik-cli.ts",
      "to": "ui/advanced-cli-ui.ts",
      "type": "import",
      "weight": 9
    },
    {
      "from": "chat/chat-orchestrator.ts",
      "to": "core/agent-manager.ts",
      "type": "import",
      "weight": 9
    },
    {
      "from": "core/agent-manager.ts",
      "to": "services/agent-service.ts",
      "type": "import",
      "weight": 7
    },
    {
      "from": "services/agent-service.ts",
      "to": "services/tool-service.ts",
      "type": "import",
      "weight": 8
    },
    {
      "from": "context/workspace-context.ts",
      "to": "context/rag-system.ts",
      "type": "import",
      "weight": 8,
      "circular": true
    },
    {
      "from": "context/rag-system.ts",
      "to": "context/semantic-search-engine.ts",
      "type": "import",
      "weight": 7,
      "circular": true
    },
    {
      "from": "context/semantic-search-engine.ts",
      "to": "context/unified-embedding-interface.ts",
      "type": "import",
      "weight": 6,
      "circular": true
    },
    {
      "from": "context/unified-embedding-interface.ts",
      "to": "context/workspace-context.ts",
      "type": "import",
      "weight": 5,
      "circular": true
    },
    {
      "from": "ui/advanced-cli-ui.ts",
      "to": "ui/terminal-output-manager.ts",
      "type": "import",
      "weight": 6,
      "circular": true
    },
    {
      "from": "ui/terminal-output-manager.ts",
      "to": "ui/streamtty-adapter.ts",
      "type": "import",
      "weight": 5,
      "circular": true
    },
    {
      "from": "ui/streamtty-adapter.ts",
      "to": "ui/advanced-cli-ui.ts",
      "type": "import",
      "weight": 4,
      "circular": true
    }
  ],
  "circularDependencies": [
    {
      "id": "context-system-loop",
      "severity": "high",
      "nodes": [
        "context/workspace-context.ts",
        "context/rag-system.ts",
        "context/semantic-search-engine.ts",
        "context/unified-embedding-interface.ts"
      ],
      "impact": "Could cause initialization deadlock or runtime errors",
      "solution": "Extract shared types to context/types.ts, use dependency injection"
    },
    {
      "id": "ui-rendering-loop",
      "severity": "medium",
      "nodes": [
        "ui/advanced-cli-ui.ts",
        "ui/terminal-output-manager.ts",
        "ui/streamtty-adapter.ts"
      ],
      "impact": "Type-only circular dependency, low runtime risk",
      "solution": "Already mitigated with interfaces, monitor for runtime issues"
    },
    {
      "id": "agent-system-loop",
      "severity": "medium",
      "nodes": [
        "core/agent-manager.ts",
        "services/agent-service.ts",
        "core/agent-factory.ts"
      ],
      "impact": "Runtime initialization order matters",
      "solution": "Use lazy loading and factory pattern"
    }
  ],
  "memoryLeaks": [
    {
      "location": "nik-cli.ts",
      "type": "unbounded-map",
      "variable": "sessionContext",
      "severity": "high",
      "description": "Map grows without size limit",
      "fix": "Implement LRU cache with max size of 100"
    },
    {
      "location": "nik-cli.ts",
      "type": "unbounded-map",
      "variable": "toolchainContext",
      "severity": "high",
      "description": "Map grows without size limit",
      "fix": "Implement LRU cache with max size of 50"
    },
    {
      "location": "nik-cli.ts",
      "type": "timer-leak",
      "variable": "statusBarTimer, promptRenderTimer",
      "severity": "medium",
      "description": "Timers may not be cleared on crash",
      "fix": "Track all timers in activeTimers Set"
    },
    {
      "location": "agent-manager.ts",
      "type": "event-listener-leak",
      "variable": "EventEmitter listeners",
      "severity": "medium",
      "description": "Event listeners not removed in cleanup",
      "fix": "Add this.removeAllListeners() in cleanup()"
    },
    {
      "location": "nik-cli.ts",
      "type": "file-watcher-leak",
      "variable": "fileWatcher",
      "severity": "low",
      "description": "Chokidar watcher may not close on crash",
      "fix": "Add process exit handlers"
    }
  ],
  "unusedImports": [
    {
      "file": "nik-cli.ts",
      "imports": ["import re", "import os", "import json"],
      "severity": "critical",
      "reason": "Invalid Python imports in TypeScript file",
      "fix": "Remove these lines immediately"
    },
    {
      "file": "nik-cli.ts",
      "imports": ["chalk (duplicate)"],
      "severity": "high",
      "reason": "Multiple imports of same module",
      "fix": "Consolidate to single import"
    }
  ],
  "recommendations": {
    "immediate": [
      "Remove invalid Python imports from nik-cli.ts",
      "Fix duplicate chalk imports",
      "Add event listener cleanup in agent-manager.ts"
    ],
    "shortTerm": [
      "Break circular dependencies in context system",
      "Implement bounded collections (LRU cache)",
      "Centralize timer management"
    ],
    "longTerm": [
      "Refactor nik-cli.ts (split into smaller modules)",
      "Implement dependency injection",
      "Add automated dependency analysis to CI/CD"
    ]
  },
  "statistics": {
    "totalFiles": 99,
    "totalLines": 50000,
    "avgFileSize": 505,
    "maxFileSize": 20378,
    "totalImports": 600,
    "totalExports": 400,
    "circularDependencies": 3,
    "memoryLeakRisks": 5,
    "unusedImports": 12,
    "duplicateImports": 15,
    "externalDependencies": 84,
    "internalDependencies": 516
  }
}
